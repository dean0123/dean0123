# SD Card åˆ†å‰² Loop åˆ†å‰² 
### 1.  `sdcard.sh` å»ºç«‹ åˆ†å‰² format æ›è¼‰
### 2. `umountsd.sh`  è§£æ›è¼‰
### 3. `mountsd.sh`  æ›è¼‰ ä¸format

    # dd if=/dev/zero of=/dev/sdb bs=512 count=1   (æ¸…ç©ºåˆ†å‰²å€)
    # fdisk /dev/sdb < fdisk.cmd  (æ‰¹æ¬¡åˆ†å‰²)
    # fdisk -lu /dev/sdb  (æª¢è¦–çµæœ)
    # mkdosfs   /dev/sd1  (ç”¨ blkid é©—æ”¶)
    # mkfs.ext4 /dev/sd2  (ç”¨ blkid é©—æ”¶)

---

## 1. ğŸ…°ï¸ `sdcard.sh`   
å¯«æˆ Script ( å¦‚ï¼šsdcard.sh) 
```bash
SDCARD=~dean/virtualarm/sdcard.img

LP0=/dev/loop0
LP1=/dev/loop1
LP2=/dev/loop2

MP1=/mnt/sdcard1
MP2=/mnt/sdcard2

FDISK_CMD=/tmp/fdisk.cmd

echo "============================ 1 Create virtual sdcard image empty file ============================"
dd if=/dev/zero of=$SDCARD bs=1G count=1

echo "============================ 2 Partiion vsdcard image File ============================"
cat > $FDISK_CMD <<EOF
n~~strikethrough text~~



+100M
p
t
b
p
n




p
w
EOF

fdisk $SDCARD <$FDISK_CMD




echo "============================ 3 ============================"
#fdisk -lu $SDCARD
#mkdosfs      $PART1
#mkfs.ext4 -F $PART2

#lsblk
#blkid
#fdisk -lu $SDCARD

# Sector(512 bypts)  Block(1024 bytes)
#
P1_OFFSET=`fdisk -lu sdcard.img | grep sdcard.img1 | tr -s ' ' | cut -d\  -f 2`
P1_SECTOR=`fdisk -lu sdcard.img | grep sdcard.img1 | tr -s ' ' | cut -d\  -f 4`
P1_BLOCK=`expr $P1_SECTOR / 1024 \* 512`
P2_OFFSET=`fdisk -lu sdcard.img | grep sdcard.img2 | tr -s ' ' | cut -d\  -f 2`
P2_SECTOR=`fdisk -lu sdcard.img | grep sdcard.img2 | tr -s ' ' | cut -d\  -f 4`
P2_BLOCK=`expr $P2_SECTOR / 1024 \* 512`
echo "Part 1 Offset = $P1_OFFSET ,  Block = $P1_BLOCK "
echo "Part 2 Offset = $P2_OFFSET ,  Block = $P2_BLOCK "


losetup $LP0 $SDCARD
# -o offset bytes ( = Offset Sector * 512 bytes/sector)
losetup -o `expr $P1_OFFSET \* 512` $LP1 $LP0
losetup -o `expr $P2_OFFSET \* 512` $LP2 $LP0


mkdosfs -s 2 $LP1 $P1_BLOCK
mkfs.ext4 /dev/loop2

mount $LP1 $MP1
mount $LP2 $MP2

blkid
losetup
losetup -a
lsblk
```


## 2. :bhutan: `umountsd.sh ` è§£æ›è¼‰
```bash
SDCARD=~dean/virtualarm/sdcard.img
LP0=/dev/loop0
LP1=/dev/loop1
LP2=/dev/loop2

MP0=/mnt/sdcard
MP1=/mnt/sdcard1
MP2=/mnt/sdcard2



echo "======================== 1 Before Umount Block ID ============================="
blkid
umount     $LP2
umount     $LP1
umount     $LP0
losetup -d $LP2
losetup -d $LP1
losetup -d $LP0
echo "======================== 2 Umount Umount Block ID ============================="

blkid
losetup
losetup -a
lsblk
```


## 3. :afghanistan:`mountsd.sh`  æ›è¼‰ï¼Œä¸ Format
```bash
SDCARD=~dean/virtualarm/sdcard.img

LP0=/dev/loop0
LP1=/dev/loop1
LP2=/dev/loop2

MP0=/mnt/sdcard
MP1=/mnt/sdcard1
MP2=/mnt/sdcard2

#
#
P1_OFFSET=`fdisk -lu sdcard.img | grep sdcard.img1 | tr -s ' ' | cut -d\  -f 2`
P1_SECTOR=`fdisk -lu sdcard.img | grep sdcard.img1 | tr -s ' ' | cut -d\  -f 4`
P1_BLOCK=`expr $P1_SECTOR / 1024 \* 512`
P2_OFFSET=`fdisk -lu sdcard.img | grep sdcard.img2 | tr -s ' ' | cut -d\  -f 2`
P2_SECTOR=`fdisk -lu sdcard.img | grep sdcard.img2 | tr -s ' ' | cut -d\  -f 4`
P2_BLOCK=`expr $P2_SECTOR / 1024 \* 512`
echo "Part 1 Offset = $P1_OFFSET ,  Block = $P1_BLOCK "
echo "Part 2 Offset = $P2_OFFSET ,  Block = $P2_BLOCK "


losetup $LP0 $SDCARD
losetup -o `expr $P1_OFFSET \* 512` $LP1 $LP0
losetup -o `expr $P2_OFFSET \* 512` $LP2 $LP0
# -o offset bytes ( = Offset Sector * 512 bytes/sector)


mount $LP1 $MP1
mount $LP2 $MP2

blkid
losetup
losetup -a
lsblk
```
***

